# CAM (Charlie API Management) — PRD

## 一、产品概述

**产品名称**：CAM（Charlie API Management）

**产品类型**：API 管理与代码生成平台

**目标用户**：前后端开发团队、微服务架构团队、API 设计者

**主要目标**：通过统一的 API 定义与管理方式，实现：

-   前后端高效联调；
-   接口版本可追溯；
-   接口文档与代码同步更新；
-   支持自动生成多语言 SDK 与前端调用代码。

---

## 二、产品愿景

> **让 API 定义成为连接前后端的唯一真实来源（Single Source of Truth）。**

在当前分布式与多语言开发体系中，API 是协作的关键纽带。
CAM 旨在成为统一的 API 中心，帮助团队：

-   聚合、规范与可视化管理各类接口；
-   自动生成接口文档与调用代码；
-   让接口迭代透明、版本可控、联调高效。

---

## 三、核心功能概述

| 功能模块                    | 说明                                                                          |
| --------------------------- | ----------------------------------------------------------------------------- |
| **1. API 上传导入**         | 支持三种接口导入方式：OpenAPI（JSON/YAML）、Thrift IDL 文件、页面内手动创建。 |
| **2. 服务管理与版本控制**   | 以「服务（Service）」为单位进行接口分组与版本管理。                           |
| **3. API 文档展示与编辑**   | 可视化展示 API 定义（参数、响应、示例、类型），支持在线编辑与预览。           |
| **4. OpenAPI 自动生成**     | 每个接口均可自动生成标准化的 OpenAPI JSON 文件，便于联调与外部导出。          |
| **5. 前端代码自动生成**     | 根据接口定义生成 TypeScript 请求代码（axios/fetch 模板可选）。                |
| **6. 权限与协作（规划中）** | 支持团队空间、权限控制与接口变更通知。                                        |

---

## 四、功能详情设计

### 1. API 上传与导入

#### 1.1 支持的导入方式

| 方式                 | 格式/文件类型     | 说明                                                                       |
| -------------------- | ----------------- | -------------------------------------------------------------------------- |
| **OpenAPI 文件导入** | `.json` / `.yaml` | 解析 OpenAPI 2.0/3.0 规范，自动生成接口定义。                              |
| **Thrift IDL 导入**  | `.thrift`         | 解析 service、struct、注解信息，映射为 RESTful API（Hertz 风格扩展支持）。 |
| **手动创建**         | 页面内操作        | 手动填写 URL、Method、参数、响应字段。                                     |

#### 1.2 导入行为

-   自动识别并归类服务（Service）；
-   支持批量上传；
-   提示解析错误或格式校验失败；
-   支持导入后在线编辑。

---

### 2. 服务与版本管理

#### 2.1 服务层级结构

-   每个「服务」代表一个逻辑系统（如：用户服务、订单服务）。
-   每个服务下包含多个「接口（API Endpoint）」。

#### 2.2 版本控制机制

-   每次更新接口定义均自动生成新版本；
-   支持版本差异对比（新增字段、修改参数、删除接口）；
-   可手动切换版本或设置默认版本。

#### 2.3 版本号命名规则

-   自动：`v1`, `v1.1`, `v2`；
-   手动：允许用户自定义语义化版本（SemVer）。

---

### 3. API 文档展示与编辑

#### 3.1 文档视图

-   列表：展示服务下所有接口（Method + URL + 描述）；
-   详情：展示请求头、路径参数、Body 参数、响应字段；
-   JSON 视图：查看原始 OpenAPI 定义。

#### 3.2 编辑能力

-   支持在线编辑接口定义；
-   自动校验字段类型；
-   保存后触发版本更新；
-   可视化参数输入（支持复杂对象嵌套编辑）。

---

### 4. OpenAPI 自动生成

#### 4.1 生成规则

-   无论接口来源（OpenAPI / Thrift / 手动），都可导出标准化 OpenAPI JSON；
-   统一字段映射规则：

    -   `path`, `method`, `parameters`, `requestBody`, `responses`；
    -   自动生成 `components.schemas`。

#### 4.2 导出方式

-   单接口导出；
-   整个服务导出；
-   全局导出（所有服务合并为一个 OpenAPI 文件）。

#### 4.3 应用场景

-   导入到 Postman / Swagger UI；
-   接口 Mock / 自动化测试；
-   外部系统文档集成。

---

### 5. 前端代码自动生成

#### 5.1 生成目标

-   为前端（TypeScript）自动生成请求代码；
-   支持常见请求库模板（axios、fetch、umi-request）。

#### 5.2 核心特性

| 功能       | 说明                                          |
| ---------- | --------------------------------------------- |
| 类型安全   | 根据 OpenAPI 定义生成类型定义（`interface`）  |
| 一键生成   | 用户可选「目标服务」后自动生成代码文件        |
| 支持导出   | 可导出 `.ts` 文件或 npm 包形式                |
| 自定义模板 | 用户可自定义请求封装模板（如 axios 实例配置） |

#### 5.3 示例输出

```ts
// 自动生成的 TypeScript 请求代码
export interface GetUserResponse {
    id: number;
    name: string;
}

export const getUser = (id: number) =>
    request<GetUserResponse>(`/api/users/${id}`, { method: "GET" });
```

---

## 五、系统架构设计（概念级）

```plaintext
+----------------------+
|      Web 前端       |
|  Vue3 / React + TS  |
|----------------------|
| - 导入接口文件       |
| - 可视化编辑器       |
| - 版本与文档视图     |
+----------------------+
            │
            ▼
+----------------------+
|       后端服务       |
|  Python (Robyn)     |
|----------------------|
| - OpenAPI 解析器     |
| - Thrift 解析器      |
| - 接口版本控制模块   |
| - 代码生成器 (TS SDK)|
+----------------------+
            │
            ▼
+----------------------+
|      存储层          |
|     PostgreSQL      |
|----------------------|
| - 服务与接口元数据   |
| - OpenAPI JSON 存储  |
| - 版本历史           |
+----------------------+
```

---

## 六、技术选型建议（可调整）

| 模块         | 推荐技术栈                                  |
| ------------ | ------------------------------------------- |
| 前端         | React + TypeScript + ArcoDesign             |
| 后端         | Robyn                                       |
| 数据库       | PostgreSQL                                  |
| 文件解析     | pyyaml / openapi-spec-validator / thriftpy2 |
| 代码生成     | openapi-typescript                          |
| 鉴权（规划） | JWT / OAuth2                                |
| 部署         | Docker + Nginx                              |

---

## 七、未来规划

| 阶段        | 目标         | 关键特性                                     |
| ----------- | ------------ | -------------------------------------------- |
| **Phase 1** | 核心功能 MVP | 导入三种格式、OpenAPI 导出、TS 代码生成      |
| **Phase 2** | 协作增强     | 用户/团队空间、接口审批流、变更通知          |
| **Phase 3** | 智能化扩展   | AI 自动文档生成、测试用例生成、Mock 数据生成 |
| **Phase 4** | 企业版支持   | 多语言 SDK 生成、微服务网关同步、CI/CD 集成  |

---

## 八、价值与竞争力

| 对比项                    | CAM 优势                                               |
| ------------------------- | ------------------------------------------------------ |
| **相对 Postman / Apifox** | 支持 Thrift IDL 导入；更贴近后端体系；更强类型一致性。 |
| **相对 SwaggerHub**       | 提供前端 TypeScript 自动生成能力；支持多来源接口定义。 |
| **相对 YApi / RAP2**      | 架构更现代化，支持版本控制、标准化 OpenAPI 生成。      |

---

## 九、命名由来

**CAM (Charlie API Management)**
寓意为：

> —— Clean, Accurate, Maintainable.

---

## 十、附录：示例工作流

```plaintext
[开发者上传 Thrift IDL]
        ↓
[CAM 解析并生成 API 列表]
        ↓
[自动生成 OpenAPI JSON]
        ↓
[自动生成前端 TypeScript SDK]
        ↓
[前后端联调，版本更新自动同步]
```
