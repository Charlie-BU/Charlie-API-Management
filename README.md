# CAM (Charlie API Management) â€” PRD

## ä¸€ã€äº§å“æ¦‚è¿°

**äº§å“åç§°**ï¼šCAMï¼ˆCharlie API Managementï¼‰

**äº§å“ç±»å‹**ï¼šAPI ç®¡ç†ä¸ä»£ç ç”Ÿæˆå¹³å°

**ç›®æ ‡ç”¨æˆ·**ï¼šå‰åç«¯å¼€å‘å›¢é˜Ÿã€å¾®æœåŠ¡æ¶æ„å›¢é˜Ÿã€API è®¾è®¡è€…

**ä¸»è¦ç›®æ ‡**ï¼šé€šè¿‡ç»Ÿä¸€çš„ API å®šä¹‰ä¸ç®¡ç†æ–¹å¼ï¼Œå®ç°ï¼š

-   å‰åç«¯é«˜æ•ˆè”è°ƒï¼›
-   æ¥å£ç‰ˆæœ¬å¯è¿½æº¯ï¼›
-   æ¥å£æ–‡æ¡£ä¸ä»£ç åŒæ­¥æ›´æ–°ï¼›
-   æ”¯æŒè‡ªåŠ¨ç”Ÿæˆå¤šè¯­è¨€ SDK ä¸å‰ç«¯è°ƒç”¨ä»£ç ã€‚

---

## äºŒã€äº§å“æ„¿æ™¯

> **è®© API å®šä¹‰æˆä¸ºè¿æ¥å‰åç«¯çš„å”¯ä¸€çœŸå®æ¥æºï¼ˆSingle Source of Truthï¼‰ã€‚**

åœ¨å½“å‰åˆ†å¸ƒå¼ä¸å¤šè¯­è¨€å¼€å‘ä½“ç³»ä¸­ï¼ŒAPI æ˜¯åä½œçš„å…³é”®çº½å¸¦ã€‚
CAM æ—¨åœ¨æˆä¸ºç»Ÿä¸€çš„ API ä¸­å¿ƒï¼Œå¸®åŠ©å›¢é˜Ÿï¼š

-   èšåˆã€è§„èŒƒä¸å¯è§†åŒ–ç®¡ç†å„ç±»æ¥å£ï¼›
-   è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£ä¸è°ƒç”¨ä»£ç ï¼›
-   è®©æ¥å£è¿­ä»£é€æ˜ã€ç‰ˆæœ¬å¯æ§ã€è”è°ƒé«˜æ•ˆã€‚

---

## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½æ¦‚è¿°

| åŠŸèƒ½æ¨¡å—                  | è¯´æ˜                                                                          | å®ç°çŠ¶æ€  |
| ------------------------- | ----------------------------------------------------------------------------- | --------- |
| **1. ç”¨æˆ·ç®¡ç†ä¸æƒé™æ§åˆ¶** | ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€åŸºäº JWT çš„é‰´æƒæœºåˆ¶ï¼Œæ”¯æŒå¤šçº§ç”¨æˆ·æƒé™ï¼ˆL0-L4ï¼‰ã€‚              | âœ… å·²å®ç° |
| **2. æœåŠ¡ç®¡ç†ä¸ç‰ˆæœ¬æ§åˆ¶** | ä»¥ã€ŒæœåŠ¡ï¼ˆServiceï¼‰ã€ä¸ºå•ä½è¿›è¡Œæ¥å£åˆ†ç»„ï¼Œæ”¯æŒå¤æ‚çš„ç‰ˆæœ¬è¿­ä»£æœºåˆ¶ã€‚             | âœ… å·²å®ç° |
| **3. API è¿­ä»£ä¸è‰ç¨¿ç®¡ç†** | æ”¯æŒ Service è¿­ä»£å‘¨æœŸå†…çš„ API å¢åˆ æ”¹ï¼Œé€šè¿‡ ApiDraft è¡¨ç®¡ç†è‰ç¨¿çŠ¶æ€ã€‚          | âœ… å·²å®ç° |
| **4. API åˆ†ç±»ç®¡ç†**       | æ”¯æŒä¸ºæ¯ä¸ª Service åˆ›å»º API åˆ†ç±»ï¼Œä¾¿äºæ¥å£ç»„ç»‡å’Œç®¡ç†ã€‚                        | âœ… å·²å®ç° |
| **5. å‚æ•°ç®¡ç†**           | å®Œæ•´çš„è¯·æ±‚å‚æ•°å’Œå“åº”å‚æ•°ç®¡ç†ï¼Œæ”¯æŒå¤æ‚åµŒå¥—ç»“æ„å’Œå¤šç§æ•°æ®ç±»å‹ã€‚                | âœ… å·²å®ç° |
| **6. API ä¸Šä¼ å¯¼å…¥**       | æ”¯æŒä¸‰ç§æ¥å£å¯¼å…¥æ–¹å¼ï¼šOpenAPIï¼ˆJSON/YAMLï¼‰ã€Thrift IDL æ–‡ä»¶ã€é¡µé¢å†…æ‰‹åŠ¨åˆ›å»ºã€‚ | ğŸ”„ è§„åˆ’ä¸­ |
| **7. OpenAPI è‡ªåŠ¨ç”Ÿæˆ**   | æ¯ä¸ªæ¥å£å‡å¯è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†åŒ–çš„ OpenAPI JSON æ–‡ä»¶ï¼Œä¾¿äºè”è°ƒä¸å¤–éƒ¨å¯¼å‡ºã€‚          | ğŸ”„ è§„åˆ’ä¸­ |
| **8. å‰ç«¯ä»£ç è‡ªåŠ¨ç”Ÿæˆ**   | æ ¹æ®æ¥å£å®šä¹‰ç”Ÿæˆ TypeScript è¯·æ±‚ä»£ç ï¼ˆaxios/fetch æ¨¡æ¿å¯é€‰ï¼‰ã€‚                | ğŸ”„ è§„åˆ’ä¸­ |

---

## å››ã€åŠŸèƒ½è¯¦æƒ…è®¾è®¡

### 1. ç”¨æˆ·ç®¡ç†ä¸æƒé™æ§åˆ¶

#### 1.1 ç”¨æˆ·æ³¨å†Œä¸ç™»å½•

-   **ç”¨æˆ·æ³¨å†Œ**ï¼šæ”¯æŒç”¨æˆ·åå¯†ç æ³¨å†Œï¼Œå¯†ç ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨
-   **ç”¨æˆ·ç™»å½•**ï¼šéªŒè¯ç”¨æˆ·åå¯†ç ï¼ŒæˆåŠŸåè¿”å› JWT è®¿é—®ä»¤ç‰Œ
-   **ä»¤ç‰Œç®¡ç†**ï¼šåŸºäº JWT çš„æ— çŠ¶æ€é‰´æƒï¼Œæ”¯æŒ Bearer Token æ ¼å¼

#### 1.2 ç”¨æˆ·æƒé™ç­‰çº§

CAM å®ç°äº†äº”çº§ç”¨æˆ·æƒé™ä½“ç³»ï¼ˆUserLevelï¼‰ï¼š

| æƒé™ç­‰çº§ | è¯´æ˜       | æƒé™èŒƒå›´                            |
| -------- | ---------- | ----------------------------------- |
| **L0**   | è¶…çº§ç®¡ç†å‘˜ | è®¿é—®æ‰€æœ‰ API å’Œèµ„æºï¼Œç³»ç»Ÿçº§ç®¡ç†æƒé™ |
| **L1**   | é«˜çº§ç®¡ç†å‘˜ | è®¿é—®å¤§éƒ¨åˆ† APIï¼Œè·¨æœåŠ¡ç®¡ç†æƒé™      |
| **L2**   | ä¸­çº§ç®¡ç†å‘˜ | è®¿é—®éƒ¨åˆ† APIï¼Œæœ‰é™çš„è·¨æœåŠ¡æƒé™      |
| **L3**   | åˆçº§ç®¡ç†å‘˜ | åŸºç¡€ API è®¿é—®æƒé™                   |
| **L4**   | æ™®é€šç”¨æˆ·   | åªèƒ½è®¿é—®è‡ªå·±åˆ›å»ºçš„æœåŠ¡å’Œ API        |

#### 1.3 API æƒé™æ§åˆ¶

-   æ¯ä¸ª API ç«¯ç‚¹éƒ½æœ‰æœ€ä½æƒé™ç­‰çº§è¦æ±‚
-   é€šè¿‡ `API_PERMISSION_MAP` é…ç½® API è®¿é—®æƒé™
-   æœªé…ç½®çš„ API é»˜è®¤å…è®¸æ‰€æœ‰ç™»å½•ç”¨æˆ·è®¿é—®
-   æ”¯æŒåŸºäºèµ„æºæ‰€æœ‰æƒçš„ç»†ç²’åº¦æƒé™æ§åˆ¶

#### 1.4 æœåŠ¡æƒé™ç®¡ç†

-   **æœåŠ¡æ‰€æœ‰è€…ï¼ˆOwnerï¼‰**ï¼šæœåŠ¡åˆ›å»ºè€…ï¼Œæ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒ
-   **æœåŠ¡ç»´æŠ¤è€…ï¼ˆMaintainerï¼‰**ï¼šå¯å‚ä¸æœåŠ¡å¼€å‘å’Œç»´æŠ¤ï¼ˆè§„åˆ’ä¸­ï¼‰
-   **æƒé™ç»§æ‰¿**ï¼šAPI æƒé™ç»§æ‰¿è‡ªæ‰€å±æœåŠ¡çš„æƒé™è®¾ç½®

---

### 2. API ä¸Šä¼ ä¸å¯¼å…¥ï¼ˆè§„åˆ’ä¸­ï¼‰

#### 2.1 æ”¯æŒçš„å¯¼å…¥æ–¹å¼

| æ–¹å¼                 | æ ¼å¼/æ–‡ä»¶ç±»å‹     | è¯´æ˜                                                                       |
| -------------------- | ----------------- | -------------------------------------------------------------------------- |
| **OpenAPI æ–‡ä»¶å¯¼å…¥** | `.json` / `.yaml` | è§£æ OpenAPI 2.0/3.0 è§„èŒƒï¼Œè‡ªåŠ¨ç”Ÿæˆæ¥å£å®šä¹‰ã€‚                              |
| **Thrift IDL å¯¼å…¥**  | `.thrift`         | è§£æ serviceã€structã€æ³¨è§£ä¿¡æ¯ï¼Œæ˜ å°„ä¸º RESTful APIï¼ˆHertz é£æ ¼æ‰©å±•æ”¯æŒï¼‰ã€‚ |
| **æ‰‹åŠ¨åˆ›å»º**         | é¡µé¢å†…æ“ä½œ        | æ‰‹åŠ¨å¡«å†™ URLã€Methodã€å‚æ•°ã€å“åº”å­—æ®µã€‚                                     |

#### 2.2 å¯¼å…¥è¡Œä¸º

-   è‡ªåŠ¨è¯†åˆ«å¹¶å½’ç±»æœåŠ¡ï¼ˆServiceï¼‰ï¼›
-   æ”¯æŒæ‰¹é‡ä¸Šä¼ ï¼›
-   æç¤ºè§£æé”™è¯¯æˆ–æ ¼å¼æ ¡éªŒå¤±è´¥ï¼›
-   æ”¯æŒå¯¼å…¥ååœ¨çº¿ç¼–è¾‘ã€‚

---

### 3. æœåŠ¡ä¸ç‰ˆæœ¬ç®¡ç†

#### 3.1 æœåŠ¡å±‚çº§ç»“æ„

-   æ¯ä¸ªã€ŒæœåŠ¡ï¼ˆServiceï¼‰ã€ä»£è¡¨ä¸€ä¸ªé€»è¾‘ç³»ç»Ÿï¼ˆå¦‚ï¼šç”¨æˆ·æœåŠ¡ã€è®¢å•æœåŠ¡ï¼‰ã€‚
-   æ¯ä¸ªæœåŠ¡å…·æœ‰å”¯ä¸€çš„ `service_uuid`ï¼ˆæ ¼å¼ï¼š`a/b/c`ï¼‰å’Œç‰ˆæœ¬å·ï¼ˆæ ¼å¼ï¼š`X.Y.Z`ï¼‰ã€‚
-   æ¯ä¸ªæœåŠ¡ä¸‹åŒ…å«å¤šä¸ªã€Œæ¥å£ï¼ˆAPI Endpointï¼‰ã€å’Œã€ŒAPI åˆ†ç±»ï¼ˆApiCategoryï¼‰ã€ã€‚
-   æœåŠ¡æ”¯æŒæ‰€æœ‰è€…ï¼ˆownerï¼‰å’Œç»´æŠ¤è€…ï¼ˆmaintainerï¼‰çš„æƒé™ç®¡ç†ã€‚

#### 3.2 ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶

CAM é‡‡ç”¨åŸºäº **ServiceIterationï¼ˆæœåŠ¡è¿­ä»£ï¼‰** çš„ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶ï¼š

-   **Service è¡¨**ï¼šå­˜å‚¨æ¯ä¸ªæœåŠ¡çš„æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
-   **ServiceIteration è¡¨**ï¼šå­˜å‚¨æœåŠ¡è¿­ä»£å‘¨æœŸå†…çš„æ‰€æœ‰å˜æ›´å’Œå†å²ç‰ˆæœ¬
-   **ApiDraft è¡¨**ï¼šåœ¨è¿­ä»£å‘¨æœŸå†…ç®¡ç† API çš„è‰ç¨¿çŠ¶æ€

#### 3.3 æœåŠ¡è¿­ä»£æµç¨‹

1. **å¼€å§‹è¿­ä»£**ï¼šç”¨æˆ·è°ƒç”¨ `/startIteration` åˆ›å»ºæ–°çš„è¿­ä»£å‘¨æœŸ

    - åˆ›å»º `ServiceIteration` è®°å½•ï¼Œæ ‡è®° `is_committed=False`
    - å¤‡ä»½å½“å‰æœåŠ¡çš„æ‰€æœ‰ä¿¡æ¯åˆ°è¿­ä»£è®°å½•ä¸­
    - è¿”å› `service_iteration_id` ä½œä¸ºè¿­ä»£å‘¨æœŸæ ‡è¯†

2. **è¿­ä»£æœŸé—´æ“ä½œ**ï¼š

    - ä¿®æ”¹æœåŠ¡æè¿°
    - æ–°å¢ APIï¼ˆåˆ›å»º ApiDraft è®°å½•ï¼‰
    - åˆ é™¤ APIï¼ˆåˆ é™¤ ApiDraft åŠå…³è”å‚æ•°ï¼‰
    - ç¼–è¾‘ APIï¼ˆæ›´æ–° ApiDraft åŠå…¶è¯·æ±‚/å“åº”å‚æ•°ï¼‰

3. **æäº¤è¿­ä»£**ï¼šç”¨æˆ·è°ƒç”¨ `/commitIteration` å®Œæˆè¿­ä»£
    - å°† ApiDraft ä¸­çš„æ‰€æœ‰å˜æ›´åŒæ­¥åˆ°æ­£å¼çš„ Api è¡¨
    - æ›´æ–°æœåŠ¡ç‰ˆæœ¬å·
    - æ ‡è®° `ServiceIteration` ä¸º `is_committed=True`

#### 3.4 ç‰ˆæœ¬å·å‘½åè§„åˆ™

-   è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼š`X.Y.Z`ï¼ˆä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢ç‰ˆæœ¬ï¼‰
-   æ‰€æœ‰æœåŠ¡åˆå§‹ç‰ˆæœ¬ä¸º `1.0.0`
-   æ”¯æŒç‰ˆæœ¬å†å²æŸ¥è¯¢å’Œç‰ˆæœ¬é—´å·®å¼‚å¯¹æ¯”

---

### 4. API ç®¡ç†ä¸å‚æ•°è®¾è®¡

#### 4.1 API åˆ†ç±»ç®¡ç†

-   **ApiCategory è¡¨**ï¼šæ”¯æŒå¯¹ API è¿›è¡Œåˆ†ç±»ç®¡ç†
-   æ¯ä¸ªåˆ†ç±»å…·æœ‰å”¯ä¸€åç§°å’Œæè¿°
-   æ”¯æŒåˆ†ç±»çš„åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤æ“ä½œ
-   API å¯ä»¥å½’å±åˆ°ç‰¹å®šåˆ†ç±»ä¸‹ï¼Œä¾¿äºç»„ç»‡å’ŒæŸ¥æ‰¾

#### 4.2 API å‚æ•°ç±»å‹ç³»ç»Ÿ

CAM æ”¯æŒå®Œæ•´çš„å‚æ•°ç±»å‹å®šä¹‰ï¼ŒåŸºäº `ParamLocation` æšä¸¾ï¼š

| å‚æ•°ä½ç½®   | è¯´æ˜         | ç¤ºä¾‹                          |
| ---------- | ------------ | ----------------------------- |
| **QUERY**  | URL æŸ¥è¯¢å‚æ•° | `?page=1&size=10`             |
| **PATH**   | URL è·¯å¾„å‚æ•° | `/users/{id}`                 |
| **HEADER** | HTTP è¯·æ±‚å¤´  | `Authorization: Bearer token` |
| **COOKIE** | Cookie å‚æ•°  | `session_id=abc123`           |
| **BODY**   | è¯·æ±‚ä½“å‚æ•°   | JSON/Form æ•°æ®                |

#### 4.3 å‚æ•°å®šä¹‰ç»“æ„

-   **RequestParam è¡¨**ï¼šå®šä¹‰ API è¯·æ±‚å‚æ•°
-   **ResponseParam è¡¨**ï¼šå®šä¹‰ API å“åº”å‚æ•°
-   æ”¯æŒå‚æ•°åµŒå¥—ï¼ˆé€šè¿‡ `parent_id` å­—æ®µï¼‰
-   æ”¯æŒå¤æ‚æ•°æ®ç±»å‹ï¼ˆå¯¹è±¡ã€æ•°ç»„ç­‰ï¼‰
-   å‚æ•°å±æ€§åŒ…æ‹¬ï¼šåç§°ã€ç±»å‹ã€æ˜¯å¦å¿…éœ€ã€é»˜è®¤å€¼ã€æè¿°ç­‰

#### 4.4 è‰ç¨¿ç®¡ç†æœºåˆ¶

åœ¨æœåŠ¡è¿­ä»£æœŸé—´ï¼Œæ‰€æœ‰ API å˜æ›´éƒ½é€šè¿‡è‰ç¨¿æœºåˆ¶ç®¡ç†ï¼š

-   **ApiDraft è¡¨**ï¼šå­˜å‚¨è¿­ä»£æœŸé—´çš„ API è‰ç¨¿
-   **RequestParamDraft è¡¨**ï¼šå­˜å‚¨è¯·æ±‚å‚æ•°è‰ç¨¿
-   **ResponseParamDraft è¡¨**ï¼šå­˜å‚¨å“åº”å‚æ•°è‰ç¨¿
-   è‰ç¨¿æ”¯æŒå®Œæ•´çš„ CRUD æ“ä½œï¼Œä¸å½±å“æ­£å¼ç‰ˆæœ¬
-   è¿­ä»£æäº¤æ—¶ï¼Œè‰ç¨¿å†…å®¹åŒæ­¥åˆ°æ­£å¼è¡¨

---

### 5. API æ–‡æ¡£å±•ç¤ºä¸ç¼–è¾‘ï¼ˆè§„åˆ’ä¸­ï¼‰

#### 5.1 æ–‡æ¡£è§†å›¾

-   åˆ—è¡¨ï¼šå±•ç¤ºæœåŠ¡ä¸‹æ‰€æœ‰æ¥å£ï¼ˆMethod + URL + æè¿°ï¼‰ï¼›
-   è¯¦æƒ…ï¼šå±•ç¤ºè¯·æ±‚å¤´ã€è·¯å¾„å‚æ•°ã€Body å‚æ•°ã€å“åº”å­—æ®µï¼›
-   JSON è§†å›¾ï¼šæŸ¥çœ‹åŸå§‹ OpenAPI å®šä¹‰ã€‚

#### 5.2 ç¼–è¾‘èƒ½åŠ›

-   æ”¯æŒåœ¨çº¿ç¼–è¾‘æ¥å£å®šä¹‰ï¼›
-   è‡ªåŠ¨æ ¡éªŒå­—æ®µç±»å‹ï¼›
-   ä¿å­˜åè§¦å‘ç‰ˆæœ¬æ›´æ–°ï¼›
-   å¯è§†åŒ–å‚æ•°è¾“å…¥ï¼ˆæ”¯æŒå¤æ‚å¯¹è±¡åµŒå¥—ç¼–è¾‘ï¼‰ã€‚

---

### 6. OpenAPI è‡ªåŠ¨ç”Ÿæˆï¼ˆè§„åˆ’ä¸­ï¼‰

#### 6.1 ç”Ÿæˆè§„åˆ™

-   æ— è®ºæ¥å£æ¥æºï¼ˆOpenAPI / Thrift / æ‰‹åŠ¨ï¼‰ï¼Œéƒ½å¯å¯¼å‡ºæ ‡å‡†åŒ– OpenAPI JSONï¼›
-   ç»Ÿä¸€å­—æ®µæ˜ å°„è§„åˆ™ï¼š

    -   `path`, `method`, `parameters`, `requestBody`, `responses`ï¼›
    -   è‡ªåŠ¨ç”Ÿæˆ `components.schemas`ã€‚

#### 6.2 å¯¼å‡ºæ–¹å¼

-   å•æ¥å£å¯¼å‡ºï¼›
-   æ•´ä¸ªæœåŠ¡å¯¼å‡ºï¼›
-   å…¨å±€å¯¼å‡ºï¼ˆæ‰€æœ‰æœåŠ¡åˆå¹¶ä¸ºä¸€ä¸ª OpenAPI æ–‡ä»¶ï¼‰ã€‚

#### 6.3 åº”ç”¨åœºæ™¯

-   å¯¼å…¥åˆ° Postman / Swagger UIï¼›
-   æ¥å£ Mock / è‡ªåŠ¨åŒ–æµ‹è¯•ï¼›
-   å¤–éƒ¨ç³»ç»Ÿæ–‡æ¡£é›†æˆã€‚

---

### 7. å‰ç«¯ä»£ç è‡ªåŠ¨ç”Ÿæˆï¼ˆè§„åˆ’ä¸­ï¼‰

#### 7.1 ç”Ÿæˆç›®æ ‡

-   ä¸ºå‰ç«¯ï¼ˆTypeScriptï¼‰è‡ªåŠ¨ç”Ÿæˆè¯·æ±‚ä»£ç ï¼›
-   æ”¯æŒå¸¸è§è¯·æ±‚åº“æ¨¡æ¿ï¼ˆaxiosã€fetchã€umi-requestï¼‰ã€‚

#### 7.2 æ ¸å¿ƒç‰¹æ€§

| åŠŸèƒ½       | è¯´æ˜                                          |
| ---------- | --------------------------------------------- |
| ç±»å‹å®‰å…¨   | æ ¹æ® OpenAPI å®šä¹‰ç”Ÿæˆç±»å‹å®šä¹‰ï¼ˆ`interface`ï¼‰  |
| ä¸€é”®ç”Ÿæˆ   | ç”¨æˆ·å¯é€‰ã€Œç›®æ ‡æœåŠ¡ã€åè‡ªåŠ¨ç”Ÿæˆä»£ç æ–‡ä»¶        |
| æ”¯æŒå¯¼å‡º   | å¯å¯¼å‡º `.ts` æ–‡ä»¶æˆ– npm åŒ…å½¢å¼                |
| è‡ªå®šä¹‰æ¨¡æ¿ | ç”¨æˆ·å¯è‡ªå®šä¹‰è¯·æ±‚å°è£…æ¨¡æ¿ï¼ˆå¦‚ axios å®ä¾‹é…ç½®ï¼‰ |

#### 5.3 ç¤ºä¾‹è¾“å‡º

```ts
// è‡ªåŠ¨ç”Ÿæˆçš„ TypeScript è¯·æ±‚ä»£ç 
export interface GetUserResponse {
    id: number;
    name: string;
}

export const getUser = (id: number) =>
    request<GetUserResponse>(`/api/users/${id}`, { method: "GET" });
```

---

## äº”ã€ç³»ç»Ÿæ¶æ„è®¾è®¡

### 5.1 æ•´ä½“æ¶æ„

```plaintext
+----------------------+
|      Web å‰ç«¯       |
|  React + TS + Arco  |
|----------------------|
| - ç”¨æˆ·ç®¡ç†ç•Œé¢       |
| - æœåŠ¡ç®¡ç†ç•Œé¢       |
| - APIç¼–è¾‘å™¨          |
| - ç‰ˆæœ¬æ§åˆ¶ç•Œé¢       |
+----------------------+
            â”‚ HTTP/JWT
            â–¼
+----------------------+
|       åç«¯æœåŠ¡       |
|  Python (Robyn)     |
|----------------------|
| - ç”¨æˆ·é‰´æƒæ¨¡å—       |
| - æœåŠ¡ç®¡ç†æ¨¡å—       |
| - APIè¿­ä»£ç®¡ç†        |
| - æƒé™æ§åˆ¶ç³»ç»Ÿ       |
+----------------------+
            â”‚ SQLAlchemy
            â–¼
+----------------------+
|      æ•°æ®åº“å±‚        |
|     PostgreSQL      |
|----------------------|
| - ç”¨æˆ·ä¸æƒé™è¡¨       |
| - æœåŠ¡ä¸ç‰ˆæœ¬è¡¨       |
| - APIä¸å‚æ•°è¡¨        |
| - è‰ç¨¿ç®¡ç†è¡¨         |
+----------------------+
```

### 5.2 æ•°æ®åº“è®¾è®¡

#### 5.2.1 æ ¸å¿ƒè¡¨ç»“æ„

| è¡¨å                     | è¯´æ˜                 | å…³é”®å­—æ®µ                                   |
| ------------------------ | -------------------- | ------------------------------------------ |
| **user**                 | ç”¨æˆ·ä¿¡æ¯             | id, username, password_hash, level         |
| **service**              | æœåŠ¡åŸºæœ¬ä¿¡æ¯         | id, service_uuid, name, version, owner_id  |
| **service_iteration**    | æœåŠ¡è¿­ä»£ç®¡ç†         | id, service_id, version, is_committed      |
| **api**                  | æ­£å¼ API å®šä¹‰        | id, service_id, method, path, name         |
| **api_draft**            | API è‰ç¨¿ï¼ˆè¿­ä»£æœŸé—´ï¼‰ | id, service_iteration_id, method, path     |
| **api_category**         | API åˆ†ç±»             | id, service_id, name, description          |
| **request_param**        | è¯·æ±‚å‚æ•°å®šä¹‰         | id, api_id, name, location, type, required |
| **response_param**       | å“åº”å‚æ•°å®šä¹‰         | id, api_id, name, type, description        |
| **request_param_draft**  | è¯·æ±‚å‚æ•°è‰ç¨¿         | id, api_draft_id, name, location, type     |
| **response_param_draft** | å“åº”å‚æ•°è‰ç¨¿         | id, api_draft_id, name, type, description  |

#### 5.2.2 æƒé™è®¾è®¡

-   **ç”¨æˆ·ç­‰çº§ï¼ˆUserLevelï¼‰**ï¼šL0-L4 äº”çº§æƒé™ä½“ç³»
-   **API æƒé™æ˜ å°„**ï¼šé€šè¿‡ `API_PERMISSION_MAP` é…ç½®ç«¯ç‚¹è®¿é—®æƒé™
-   **èµ„æºæ‰€æœ‰æƒ**ï¼šåŸºäº `owner_id` çš„èµ„æºè®¿é—®æ§åˆ¶
-   **æœåŠ¡æƒé™**ï¼šæ”¯æŒæ‰€æœ‰è€…å’Œç»´æŠ¤è€…è§’è‰²ï¼ˆç»´æŠ¤è€…åŠŸèƒ½è§„åˆ’ä¸­ï¼‰

### 5.3 æœåŠ¡è¿­ä»£æœºåˆ¶

```plaintext
æœåŠ¡è¿­ä»£ç”Ÿå‘½å‘¨æœŸï¼š

1. å¼€å§‹è¿­ä»£ (/startIteration)
   â”œâ”€â”€ åˆ›å»º ServiceIteration è®°å½•
   â”œâ”€â”€ è®¾ç½® is_committed = False
   â””â”€â”€ è¿”å› service_iteration_id

2. è¿­ä»£æœŸé—´æ“ä½œ
   â”œâ”€â”€ åˆ›å»º/ç¼–è¾‘ ApiDraft
   â”œâ”€â”€ ç®¡ç† RequestParamDraft
   â”œâ”€â”€ ç®¡ç† ResponseParamDraft
   â””â”€â”€ ä¿®æ”¹æœåŠ¡æè¿°

3. æäº¤è¿­ä»£ (/commitIteration)
   â”œâ”€â”€ åŒæ­¥è‰ç¨¿åˆ°æ­£å¼è¡¨
   â”œâ”€â”€ æ›´æ–°æœåŠ¡ç‰ˆæœ¬å·
   â”œâ”€â”€ è®¾ç½® is_committed = True
   â””â”€â”€ æ¸…ç†è‰ç¨¿æ•°æ®
```

---

## å…­ã€æŠ€æœ¯é€‰å‹ï¼ˆå·²å®ç°ï¼‰

| æ¨¡å—         | æŠ€æœ¯æ ˆ                                      | è¯´æ˜                              |
| ------------ | ------------------------------------------- | --------------------------------- |
| å‰ç«¯         | React + TypeScript + ArcoDesign             | ç°ä»£åŒ–å‰ç«¯æ¡†æ¶ï¼Œç±»å‹å®‰å…¨          |
| åç«¯æ¡†æ¶     | Python + Robyn                              | é«˜æ€§èƒ½å¼‚æ­¥ Web æ¡†æ¶               |
| æ•°æ®åº“       | PostgreSQL                                  | å…³ç³»å‹æ•°æ®åº“ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢        |
| ORM          | SQLAlchemy                                  | Python ORMï¼Œæ”¯æŒæ•°æ®åº“è¿ç§»        |
| æ•°æ®åº“è¿ç§»   | Alembic                                     | è‡ªåŠ¨åŒ–æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†              |
| ä¾èµ–ç®¡ç†     | uv                                          | å¿«é€Ÿ Python åŒ…ç®¡ç†å™¨              |
| é‰´æƒ         | JWT + Bearer Token                          | åŸºäº Token çš„æ— çŠ¶æ€é‰´æƒ           |
| å¯†ç åŠ å¯†     | bcrypt                                      | å®‰å…¨çš„å¯†ç å“ˆå¸Œç®—æ³•                |
| ç¯å¢ƒå˜é‡ç®¡ç† | python-dotenv                               | ç¯å¢ƒé…ç½®ç®¡ç†                      |
| æ–‡ä»¶è§£æ     | pyyaml / openapi-spec-validator / thriftpy2 | å¤šæ ¼å¼æ–‡ä»¶è§£ææ”¯æŒ                |
| ä»£ç ç”Ÿæˆ     | openapi-typescript                          | TypeScript ç±»å‹å’Œè¯·æ±‚ä»£ç è‡ªåŠ¨ç”Ÿæˆ |
| éƒ¨ç½²         | Docker + Nginx                              | å®¹å™¨åŒ–éƒ¨ç½²                        |

---

## ä¸ƒã€å¼€å‘è¿›åº¦ä¸æœªæ¥è§„åˆ’

### 7.1 å½“å‰å®ç°çŠ¶æ€

| åŠŸèƒ½æ¨¡å—           | çŠ¶æ€      | è¯´æ˜                                  |
| ------------------ | --------- | ------------------------------------- |
| **ç”¨æˆ·ç®¡ç†ä¸é‰´æƒ** | âœ… å·²å®Œæˆ | ç”¨æˆ·æ³¨å†Œ/ç™»å½•ã€JWT é‰´æƒã€äº”çº§æƒé™ä½“ç³» |
| **æœåŠ¡ç®¡ç†**       | âœ… å·²å®Œæˆ | æœåŠ¡åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€æ‰€æœ‰æƒç®¡ç†      |
| **ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶**   | âœ… å·²å®Œæˆ | ServiceIteration è¿­ä»£æœºåˆ¶ã€è‰ç¨¿ç®¡ç†   |
| **API ç®¡ç†**       | âœ… å·²å®Œæˆ | API CRUDã€å‚æ•°ç®¡ç†ã€åˆ†ç±»ç®¡ç†          |
| **æƒé™æ§åˆ¶ç³»ç»Ÿ**   | âœ… å·²å®Œæˆ | API çº§æƒé™æ§åˆ¶ã€èµ„æºæ‰€æœ‰æƒéªŒè¯        |
| **æ•°æ®åº“è®¾è®¡**     | âœ… å·²å®Œæˆ | å®Œæ•´çš„è¡¨ç»“æ„è®¾è®¡ã€Alembic è¿ç§»ç®¡ç†    |

### 7.2 è§„åˆ’ä¸­åŠŸèƒ½

| åŠŸèƒ½æ¨¡å—         | ä¼˜å…ˆçº§ | è¯´æ˜                                |
| ---------------- | ------ | ----------------------------------- |
| **API æ–‡æ¡£å±•ç¤º** | ğŸ”¥ é«˜  | å¯è§†åŒ– API æ–‡æ¡£ç•Œé¢ã€åœ¨çº¿ç¼–è¾‘å™¨     |
| **æ–‡ä»¶å¯¼å…¥åŠŸèƒ½** | ğŸ”¥ é«˜  | OpenAPI/Swagger/Thrift æ–‡ä»¶è§£æå¯¼å…¥ |
| **OpenAPI å¯¼å‡º** | ğŸ”¥ é«˜  | æ ‡å‡† OpenAPI JSON æ ¼å¼å¯¼å‡º          |
| **å‰ç«¯ä»£ç ç”Ÿæˆ** | ğŸ”¶ ä¸­  | TypeScript è¯·æ±‚ä»£ç è‡ªåŠ¨ç”Ÿæˆ         |
| **åä½œåŠŸèƒ½å¢å¼º** | ğŸ”¶ ä¸­  | æœåŠ¡ç»´æŠ¤è€…è§’è‰²ã€å›¢é˜Ÿåä½œ            |
| **API æµ‹è¯•åŠŸèƒ½** | ğŸ”¶ ä¸­  | åœ¨çº¿ API æµ‹è¯•ã€Mock æ•°æ®ç”Ÿæˆ        |
| **æ™ºèƒ½åŒ–æ‰©å±•**   | ğŸ”µ ä½  | AI æ–‡æ¡£ç”Ÿæˆã€æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ           |

### 7.3 å¼€å‘è·¯çº¿å›¾

| é˜¶æ®µ        | æ—¶é—´è§„åˆ’ | å…³é”®ç›®æ ‡                                |
| ----------- | -------- | --------------------------------------- |
| **Phase 1** | å½“å‰é˜¶æ®µ | âœ… å®Œæˆåç«¯æ ¸å¿ƒåŠŸèƒ½ã€ç”¨æˆ·æƒé™ã€ç‰ˆæœ¬æ§åˆ¶ |
| **Phase 2** | ä¸‹ä¸€é˜¶æ®µ | ğŸš§ å‰ç«¯ç•Œé¢å¼€å‘ã€æ–‡ä»¶å¯¼å…¥ã€OpenAPI å¯¼å‡º |
| **Phase 3** | æœªæ¥è§„åˆ’ | ğŸ“‹ åä½œåŠŸèƒ½ã€API æµ‹è¯•ã€ä»£ç ç”Ÿæˆ         |
| **Phase 4** | é•¿æœŸè§„åˆ’ | ğŸ¤– æ™ºèƒ½åŒ–åŠŸèƒ½ã€AI è¾…åŠ©ã€é«˜çº§åˆ†æ        |

---

## å…«ã€ä»·å€¼ä¸ç«äº‰åŠ›

| å¯¹æ¯”é¡¹                    | CAM ä¼˜åŠ¿                                               |
| ------------------------- | ------------------------------------------------------ |
| **ç›¸å¯¹ Postman / Apifox** | æ”¯æŒ Thrift IDL å¯¼å…¥ï¼›æ›´è´´è¿‘åç«¯ä½“ç³»ï¼›æ›´å¼ºç±»å‹ä¸€è‡´æ€§ã€‚ |
| **ç›¸å¯¹ SwaggerHub**       | æä¾›å‰ç«¯ TypeScript è‡ªåŠ¨ç”Ÿæˆèƒ½åŠ›ï¼›æ”¯æŒå¤šæ¥æºæ¥å£å®šä¹‰ã€‚ |
| **ç›¸å¯¹ YApi / RAP2**      | æ¶æ„æ›´ç°ä»£åŒ–ï¼Œæ”¯æŒç‰ˆæœ¬æ§åˆ¶ã€æ ‡å‡†åŒ– OpenAPI ç”Ÿæˆã€‚      |

---

## ä¹ã€å‘½åç”±æ¥

**CAM (Charlie API Management)**
å¯“æ„ä¸ºï¼š

> â€”â€” Clean, Accurate, Maintainable.

---

## å…«ã€ç¤ºä¾‹å·¥ä½œæµ

### 8.1 ç”¨æˆ·æ³¨å†Œä¸æœåŠ¡åˆ›å»ºæµç¨‹

```plaintext
[ç”¨æˆ·æ³¨å†Œ] â†’ [ç™»å½•è·å–JWT] â†’ [åˆ›å»ºæœåŠ¡] â†’ [è®¾ç½®æœåŠ¡åŸºæœ¬ä¿¡æ¯]
    â†“
[è·å¾—æœåŠ¡æ‰€æœ‰æƒ] â†’ [å¼€å§‹APIå¼€å‘]
```

### 8.2 æœåŠ¡è¿­ä»£å¼€å‘æµç¨‹

```plaintext
1. å¼€å§‹è¿­ä»£
[è°ƒç”¨ /startIteration] â†’ [åˆ›å»ºServiceIterationè®°å½•] â†’ [è·å¾—service_iteration_id]
                                    â†“
2. è¿­ä»£æœŸé—´å¼€å‘
[åˆ›å»ºAPIè‰ç¨¿] â†’ [å®šä¹‰è¯·æ±‚å‚æ•°] â†’ [å®šä¹‰å“åº”å‚æ•°] â†’ [è®¾ç½®APIåˆ†ç±»]
       â†“              â†“              â†“              â†“
[ApiDraftè¡¨] â†’ [RequestParamDraft] â†’ [ResponseParamDraft] â†’ [ApiCategoryè¡¨]
                                    â†“
3. æäº¤è¿­ä»£
[è°ƒç”¨ /commitIteration] â†’ [è‰ç¨¿åŒæ­¥åˆ°æ­£å¼è¡¨] â†’ [ç‰ˆæœ¬å·æ›´æ–°] â†’ [è¿­ä»£å®Œæˆ]
```

### 8.3 æƒé™æ§åˆ¶ç¤ºä¾‹

```plaintext
ç”¨æˆ·æƒé™ç­‰çº§éªŒè¯ï¼ˆæš‚å®šï¼‰ï¼š
L4ç”¨æˆ· â†’ [åªèƒ½è®¿é—®è‡ªå·±åˆ›å»ºçš„æœåŠ¡] â†’ [APIæ“ä½œå—é™]
L0ç”¨æˆ· â†’ [è®¿é—®æ‰€æœ‰æœåŠ¡å’ŒAPI] â†’ [ç³»ç»Ÿç®¡ç†æƒé™]

APIæƒé™éªŒè¯ï¼š
è¯·æ±‚API â†’ [æ£€æŸ¥JWTä»¤ç‰Œ] â†’ [éªŒè¯ç”¨æˆ·ç­‰çº§] â†’ [æ£€æŸ¥èµ„æºæ‰€æœ‰æƒ] â†’ [å…è®¸/æ‹’ç»è®¿é—®]
```

### 8.4 å®Œæ•´å¼€å‘åœºæ™¯ç¤ºä¾‹

```plaintext
åœºæ™¯ï¼šå¼€å‘å›¢é˜Ÿåˆ›å»ºç”¨æˆ·æœåŠ¡API

1. å›¢é˜Ÿè´Ÿè´£äººæ³¨å†Œå¹¶åˆ›å»ºæœåŠ¡
   POST /register â†’ POST /login â†’ POST /service/create

2. å¼€å§‹ç”¨æˆ·æœåŠ¡v1.0.0å¼€å‘
   POST /service/{service_id}/startIteration

3. åˆ›å»ºç”¨æˆ·ç›¸å…³API
   - POST /api/draft/create (åˆ›å»ºç”¨æˆ·æ³¨å†ŒAPI)
   - POST /api/draft/create (åˆ›å»ºç”¨æˆ·ç™»å½•API)
   - POST /api/draft/create (åˆ›å»ºç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢API)

4. ä¸ºæ¯ä¸ªAPIå®šä¹‰å‚æ•°
   - POST /param/draft/request (å®šä¹‰è¯·æ±‚å‚æ•°)
   - POST /param/draft/response (å®šä¹‰å“åº”å‚æ•°)

5. å®Œæˆå¼€å‘å¹¶æäº¤
   POST /service/{service_id}/commitIteration

6. æœåŠ¡ç‰ˆæœ¬æ›´æ–°ä¸ºv1.0.0ï¼ŒAPIæ­£å¼ç”Ÿæ•ˆ
```

---
